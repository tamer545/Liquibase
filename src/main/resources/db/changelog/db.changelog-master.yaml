databaseChangeLog:
  - changeSet:
      id: 1
      author: Timo Angst
      changes:
        - createTable:
            tableName: article
            columns:
              - column:
                  name: id
                  type: uuid
                  constraints:
                    primaryKey: true
              - column:
                  name: title
                  type: varchar(255)
                  constraints:
                    nullable: false
              - column:
                  name: text
                  type: varchar(255)

  # Aufgabe 1
  - changeSet:
      id: 2
      author: Timo Angst
      changes:
        - modifyDataType:
            columnName: text
            newDataType: varchar(999)
            tableName: article

  # Aufgabe 2
  - changeSet:
      id: 3
      author: Timo Angst
      changes:
        - renameTable:
            newTableName: articles
            oldTableName: article

  # Aufgabe 3
  - changeSet:
      id: 4
      author: Timo Angst
      changes:
        - addColumn:
            tableName: articles
            columns:
              - column:
                  name: version
                  type: integer
                  defaultValue: 1
              - column:
                  name: created_ts
                  type: timestamp(6)
                  defaultValue: CURRENT_TIMESTAMP

  # Aufgabe 4
  - changeSet:
      id: 5
      author: Timo Angst
      changes:
        - createTable:
            tableName: comments
            columns:
              - column:
                  name: id
                  type: int
                  constraints:
                    primaryKey: true
              - column:
                  name: text
                  type: varchar(255)
                  constraints:
                    nullable: false
              - column:
                  name: article_id
                  type: uuid
              foreignKeys:
                - foreignKey:
                    foreignTableName: articles
                    foreignColumnNames: id
                    onDelete: CASCADE
                    onUpdate: CASCADE
                    columnNames: article_id

  # Aufgabe 5
  - changeSet:
      author: Timo Angst
      id: 6
      changes:
        - createIndex:
            indexName: title_index
            tableName: articles
            columns:
              - column:
                  descending: true
                  name: title
      preConditions:
        - onFail: WARN
        - sqlCheck:
            expectedResult: 0
            sql: select count(*) from DATABASECHANGELOGLOCK

  # Aufgabe 6
  - changeSet:
      author: Timo Angst
      id: 7
      changes:
        - addColumn:
            tableName: articles
            columns:
              - column:
                  name: category
                  type: int
        - createTable:
            tableName: category
            columns:
              - column:
                  name: name
                  type: varchar(255)
                  constraints:
                    primaryKey: true
              - column:
                  name: description
                  type: varchar(255)
            foreignKeys:
              - foreignKey:
                  foreignTableName: articles
                  foreignColumnNames: name
                  onDelete: CASCADE
                  onUpdate: CASCADE
                  columnNames: article_name

  # Aufgabe 7
  - changeSet:
      author: Timo Angst
      id: 8
      changes:
        - insert:
            tableName: articles
            columns:
              - column:
                  name: id
                  value: 93f6cccf-62c2-4b1a-9cf0-af7f4f429807
              - column:
                  name: title
                  value: "some sample article title"
              - column:
                  name: text
                  value: "a sample article text"
              - column:
                  name: category
                  value: 1
        - insert:
            tableName: category
            columns:
              - column:
                  name: name
                  value: "some sample category name"
              - column:
                  name: description
                  value: "a sample category description"
        - insert:
            tableName: comments
            columns:
              - column:
                  name: id
                  value: 1
              - column:
                  name: text
                  value: "a sample comment"
              - column:
                  name: article_id
                  value: 93f6cccf-62c2-4b1a-9cf0-af7f4f429807